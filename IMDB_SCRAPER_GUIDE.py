# ==========================================================
# IMDB í¬ë¡¤ëŸ¬ ì‚¬ìš© ê°€ì´ë“œ
# ==========================================================

"""
IMDB ë°ì´í„° í¬ë¡¤ëŸ¬ - ì™„ì „ ê°€ì´ë“œ

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” TMDBì—ì„œ ìˆ˜ì§‘í•œ TV ì‹œë¦¬ì¦ˆ ë°ì´í„°ì—ì„œ IMDB IDë¥¼ ì¶”ì¶œí•˜ì—¬
IMDB ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì¶”ê°€ ì •ë³´ë¥¼ í¬ë¡¤ë§í•©ë‹ˆë‹¤.

ìˆ˜ì§‘ ë°ì´í„°:
1. IMDB Rating (í‰ì )
2. IMDB Rating Count (í‰ì  íˆ¬í‘œ ìˆ˜)
3. Meta Score (ë©”íƒ€í¬ë¦¬í‹± ì ìˆ˜)
4. User Reviews (ì‚¬ìš©ì ë¦¬ë·°)

==========================================================
ì„¤ì¹˜ í•„ìš” íŒ¨í‚¤ì§€
==========================================================

pip install aiohttp beautifulsoup4 pandas --break-system-packages

==========================================================
ê¸°ë³¸ ì‚¬ìš©ë²•
==========================================================

python imdb_scraper.py

# ë˜ëŠ” ì»¤ìŠ¤í…€ ì…ë ¥ íŒŒì¼:
python imdb_scraper_advanced.py --input your_data.csv

==========================================================
ì£¼ìš” ê¸°ëŠ¥
==========================================================

1. ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ê³ ì† ìˆ˜ì§‘
2. Rate Limitingìœ¼ë¡œ ì°¨ë‹¨ ë°©ì§€ (ì´ˆë‹¹ 2íšŒ)
3. ìë™ ì¬ì‹œë„ ë¡œì§
4. ì²´í¬í¬ì¸íŠ¸ ê¸°ëŠ¥ (ì¤‘ë‹¨ ì‹œ ì´ì–´ì„œ ì§„í–‰ ê°€ëŠ¥)
5. ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§

==========================================================
ì¤‘ìš” ì£¼ì˜ì‚¬í•­
==========================================================

âš ï¸ IMDB ì´ìš© ì•½ê´€ ì¤€ìˆ˜
- IMDBì˜ robots.txtë¥¼ í™•ì¸í•˜ì„¸ìš”
- ê³¼ë„í•œ ìš”ì²­ìœ¼ë¡œ IP ì°¨ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ìƒì—…ì  ìš©ë„ ê¸ˆì§€ (ê°œì¸ ì—°êµ¬/í•™ìŠµ ëª©ì ë§Œ)

âš ï¸ Rate Limiting
- ê¸°ë³¸ê°’: ì´ˆë‹¹ 2íšŒ (ì•ˆì „)
- ì†ë„ë¥¼ ë†’ì´ë©´ ì°¨ë‹¨ ìœ„í—˜ ì¦ê°€
- ëŒ€ëŸ‰ ìˆ˜ì§‘ ì‹œ ì—¬ëŸ¬ ë‚ ì— ê±¸ì³ ì§„í–‰ ê¶Œì¥

âš ï¸ HTML êµ¬ì¡° ë³€ê²½
- IMDBê°€ ì›¹ì‚¬ì´íŠ¸ êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ë©´ ì‘ë™ ì•ˆ í•  ìˆ˜ ìˆìŒ
- ì •ê¸°ì ìœ¼ë¡œ ì½”ë“œ ì—…ë°ì´íŠ¸ í•„ìš”

==========================================================
ì„±ëŠ¥ ì˜ˆìƒ
==========================================================

ì¡°ê±´: vote_count >= 30 & imdb_id ì¡´ì¬
ì†ë„: ì´ˆë‹¹ 2íšŒ ìš”ì²­
ì‹œê°„: 100ê°œ â†’ ì•½ 1ë¶„
      1,000ê°œ â†’ ì•½ 8ë¶„
      10,000ê°œ â†’ ì•½ 1.5ì‹œê°„

==========================================================
ì¶œë ¥ íŒŒì¼
==========================================================

1. imdb_data_collected.csv
   - ëª¨ë“  ìˆ˜ì§‘ ë°ì´í„° (CSV í˜•ì‹)
   
2. imdb_data_collected.parquet
   - Parquet í˜•ì‹ (ë” íš¨ìœ¨ì )
   
3. imdb_checkpoint.json
   - ì§„í–‰ ìƒí™© ì²´í¬í¬ì¸íŠ¸
   - ì¤‘ë‹¨ í›„ ì¬ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ì´ì–´ì„œ ì§„í–‰

==========================================================
ë°ì´í„° êµ¬ì¡°
==========================================================

ì¶œë ¥ CSV ì»¬ëŸ¼:
- imdb_id: IMDB ID (ì˜ˆ: tt1234567)
- series_title: ì‹œë¦¬ì¦ˆ ì œëª©
- imdb_rating: IMDB í‰ì  (0-10)
- imdb_rating_count: í‰ì  íˆ¬í‘œ ìˆ˜
- meta_score: ë©”íƒ€í¬ë¦¬í‹± ì ìˆ˜ (0-100)
- reviews_json: ë¦¬ë·° ë°ì´í„° (JSON ë¬¸ìì—´)
- scraped_at: ìˆ˜ì§‘ ì‹œê°

reviews_json êµ¬ì¡°:
[
  {
    "title": "ë¦¬ë·° ì œëª©",
    "user_rating": 8,
    "content": "ë¦¬ë·° ë‚´ìš©...",
    "author": "ì‘ì„±ì",
    "date": "ì‘ì„±ì¼",
    "helpful": "12/15"
  },
  ...
]

==========================================================
ê³ ê¸‰ ì‚¬ìš©ë²•
==========================================================

# 1. ë‹¤ë¥¸ CSV íŒŒì¼ ì‚¬ìš©
python imdb_scraper_advanced.py --input my_series.csv

# 2. ì†ë„ ì¡°ì ˆ (ìœ„í—˜!)
python imdb_scraper_advanced.py --rate 3

# 3. ë¦¬ë·° ê°œìˆ˜ ì¡°ì ˆ
python imdb_scraper_advanced.py --max-reviews 20

# 4. ì²´í¬í¬ì¸íŠ¸ ë¦¬ì…‹
python imdb_scraper_advanced.py --reset

==========================================================
ë¬¸ì œ í•´ê²°
==========================================================

Q: "429 Too Many Requests" ì—ëŸ¬
A: Rate limitingì— ê±¸ë ¸ìŠµë‹ˆë‹¤. 
   â†’ MAX_CALLS_PER_SECOND ê°’ì„ ë‚®ì¶”ì„¸ìš”
   â†’ ì ì‹œ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë‹¤ì‹œ ì‹œë„

Q: ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ì§€ ì•ŠìŒ
A: IMDB HTML êµ¬ì¡°ê°€ ë³€ê²½ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
   â†’ ë¸Œë¼ìš°ì €ì—ì„œ í•´ë‹¹ í˜ì´ì§€ í™•ì¸
   â†’ ì½”ë“œì˜ CSS ì„ íƒì ì—…ë°ì´íŠ¸ í•„ìš”

Q: ì¤‘ê°„ì— ì¤‘ë‹¨ë¨
A: ì²´í¬í¬ì¸íŠ¸ ê¸°ëŠ¥ì´ ìë™ ì‘ë™í•©ë‹ˆë‹¤
   â†’ ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ ì´ì–´ì„œ ì§„í–‰

Q: ì†ë„ê°€ ë„ˆë¬´ ëŠë¦¼
A: ì•ˆì „ì„ ìœ„í•´ ë³´ìˆ˜ì ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤
   â†’ Rateë¥¼ ë†’ì´ë©´ ë¹¨ë¼ì§€ì§€ë§Œ ì°¨ë‹¨ ìœ„í—˜ ì¦ê°€
   â†’ ì—¬ëŸ¬ ë‚ ì— ê±¸ì³ ìˆ˜ì§‘ ê¶Œì¥

==========================================================
ë²•ì  ê³ ì§€
==========================================================

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” êµìœ¡/ì—°êµ¬ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.

- IMDBì˜ ì´ìš© ì•½ê´€ì„ ë°˜ë“œì‹œ ì¤€ìˆ˜í•˜ì„¸ìš”
- ìƒì—…ì  ìš©ë„ë¡œ ì‚¬ìš© ê¸ˆì§€
- ìˆ˜ì§‘í•œ ë°ì´í„°ì˜ ì¬ë°°í¬ ê¸ˆì§€
- ê³¼ë„í•œ ìš”ì²­ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ë¶€ë‹´ ì£¼ì§€ ë§ˆì„¸ìš”

ìì„¸í•œ ë‚´ìš©ì€ IMDB ì´ìš© ì•½ê´€ ì°¸ê³ :
https://www.imdb.com/conditions

==========================================================
"""

# ==========================================================
# ê³ ê¸‰ ë²„ì „: ëª…ë ¹ì¤„ ì¸ì ì§€ì›
# ==========================================================

import argparse
import asyncio
import sys
from pathlib import Path

def parse_args():
    parser = argparse.ArgumentParser(description='IMDB ë°ì´í„° í¬ë¡¤ëŸ¬')
    parser.add_argument('--input', '-i', default='tv_series_2013_0101_0215_FULL.csv',
                        help='ì…ë ¥ CSV íŒŒì¼ ê²½ë¡œ')
    parser.add_argument('--output', '-o', default='imdb_data_collected.csv',
                        help='ì¶œë ¥ CSV íŒŒì¼ ì´ë¦„')
    parser.add_argument('--rate', '-r', type=float, default=2.0,
                        help='ì´ˆë‹¹ ìµœëŒ€ ìš”ì²­ ìˆ˜ (ê¸°ë³¸: 2)')
    parser.add_argument('--max-reviews', '-m', type=int, default=10,
                        help='ìˆ˜ì§‘í•  ìµœëŒ€ ë¦¬ë·° ê°œìˆ˜ (ê¸°ë³¸: 10)')
    parser.add_argument('--vote-threshold', '-v', type=int, default=30,
                        help='ìµœì†Œ vote_count ì¡°ê±´ (ê¸°ë³¸: 30)')
    parser.add_argument('--reset', action='store_true',
                        help='ì²´í¬í¬ì¸íŠ¸ ë¦¬ì…‹ (ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘)')
    parser.add_argument('--batch-size', '-b', type=int, default=50,
                        help='ë°°ì¹˜ í¬ê¸° (ê¸°ë³¸: 50)')
    return parser.parse_args()

def main():
    args = parse_args()
    
    # ì…ë ¥ íŒŒì¼ í™•ì¸
    if not Path(args.input).exists():
        print(f"âŒ ì…ë ¥ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {args.input}")
        sys.exit(1)
    
    # ì²´í¬í¬ì¸íŠ¸ ë¦¬ì…‹
    if args.reset and Path('imdb_checkpoint.json').exists():
        Path('imdb_checkpoint.json').unlink()
        print("âœ… ì²´í¬í¬ì¸íŠ¸ ë¦¬ì…‹ ì™„ë£Œ")
    
    print(f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          IMDB ë°ì´í„° í¬ë¡¤ëŸ¬ - ì„¤ì •                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ì…ë ¥ íŒŒì¼: {args.input:38s}  â•‘
â•‘ ì¶œë ¥ íŒŒì¼: {args.output:38s}  â•‘
â•‘ ì†ë„ ì œí•œ: {args.rate} ìš”ì²­/ì´ˆ                              â•‘
â•‘ ë¦¬ë·° ê°œìˆ˜: {args.max_reviews}ê°œ                                   â•‘
â•‘ Vote ì¡°ê±´: >= {args.vote_threshold}                                â•‘
â•‘ ë°°ì¹˜ í¬ê¸°: {args.batch_size}                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)
    
    # imdb_scraper ëª¨ë“ˆì„ ìˆ˜ì •í•˜ì—¬ ì‹¤í–‰
    # (ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ì•ˆë‚´ë§Œ)
    print("ğŸ’¡ imdb_scraper.pyë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ì—¬ ì„¤ì •ì„ ë³€ê²½í•˜ì„¸ìš”.")
    print("ë˜ëŠ” ì•„ë˜ ì½”ë“œë¥¼ imdb_scraper_advanced.pyë¡œ ì €ì¥í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”.")

if __name__ == "__main__":
    main()
